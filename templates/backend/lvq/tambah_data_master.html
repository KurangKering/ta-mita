{% extends "backend/base.html" %}
{% load static %}
{% block content %}
<div class="nk-block-head nk-block-head-sm">
	<div class="nk-block-between">
		<div class="nk-block-head-content">
			<h3 class="nk-block-title page-title">Tambah Data Master</h3>
			<div class="nk-block-des text-soft">
				<p></p>
			</div>
		</div>

	</div>
</div>
<div class="nk-block">
	<div class="card card-preview">
		<div class="card-inner">
			<ul class="nav nav-tabs mt-n3">
				<li class="nav-item">
					<a class="nav-link active" data-toggle="tab" href="#tabManual"><em class="icon ni ni-user"></em><span>Input Manual</span></a>
				</li>
				<li class="nav-item">
					<a class="nav-link" data-toggle="tab" href="#tabExcel"><em class="icon ni ni-lock-alt"></em><span>Input Excel</span></a>
				</li>


			</ul>
			<div class="tab-content">
				<div class="tab-pane active" id="tabManual">
					<form id="form-tambah-manual" onsubmit="return false;">
						{% csrf_token %}
						<div class="row gy-4">
							<div class="col-sm-6">
								<div class="form-group">
									<label class="form-label" for="default-01">AGE</label>
									<div class="form-control-wrap">
										<input type="number" class="form-control input-manual" value="1" id="input-manual-age" name="input-manual-age" placeholder="" required>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label class="form-label" for="default-01">SEX</label>
									<div class="form-control-wrap">
										<input type="number" class="form-control input-manual" value="1" id="input-manual-sex" name="input-manual-sex" placeholder="" required>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label class="form-label" for="default-01">STEROID</label>
									<div class="form-control-wrap">
										<input type="number" class="form-control input-manual" value="1" id="input-manual-steroid" name="input-manual-steroid" placeholder="" required>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label class="form-label" for="default-01">ANTIVIRALS</label>
									<div class="form-control-wrap">
										<input type="number" class="form-control input-manual" value="1" id="input-manual-antivirals" name="input-manual-antivirals" placeholder="" required>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label class="form-label" for="default-01">FATIGUE</label>
									<div class="form-control-wrap">
										<input type="number" class="form-control input-manual" value="1" id="input-manual-fatigue" name="input-manual-fatigue" placeholder="" required>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label class="form-label" for="default-01">MALAISE</label>
									<div class="form-control-wrap">
										<input type="number" class="form-control input-manual" value="1" id="input-manual-malaise" name="input-manual-malaise" placeholder="" required>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label class="form-label" for="default-01">ANOREXIA</label>
									<div class="form-control-wrap">
										<input type="number" class="form-control input-manual" value="1" id="input-manual-anorexia" name="input-manual-anorexia" placeholder="" required>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label class="form-label" for="default-01">LIVER_BIG</label>
									<div class="form-control-wrap">
										<input type="number" class="form-control input-manual" value="1" id="input-manual-liver_big" name="input-manual-liver_big" placeholder="" required>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label class="form-label" for="default-01">LIVER_FIRM</label>
									<div class="form-control-wrap">
										<input type="number" class="form-control input-manual" value="1" id="input-manual-liver_firm" name="input-manual-liver_firm" placeholder="" required>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label class="form-label" for="default-01">SPLEEN_PALPABLE</label>
									<div class="form-control-wrap">
										<input type="number" class="form-control input-manual" value="1" id="input-manual-spleen_palpable" name="input-manual-spleen_palpable" placeholder="" required>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label class="form-label" for="default-01">SPIDERS</label>
									<div class="form-control-wrap">
										<input type="number" class="form-control input-manual" value="1" id="input-manual-spiders" name="input-manual-spiders" placeholder="" required>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label class="form-label" for="default-01">ASCITES</label>
									<div class="form-control-wrap">
										<input type="number" class="form-control input-manual" value="1" id="input-manual-ascites" name="input-manual-ascites" placeholder="" required>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label class="form-label" for="default-01">VARICES</label>
									<div class="form-control-wrap">
										<input type="number" class="form-control input-manual" value="1" id="input-manual-varices" name="input-manual-varices" placeholder="" required>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label class="form-label" for="default-01">BILIRUBIN</label>
									<div class="form-control-wrap">
										<input type="number" class="form-control input-manual" value="1" id="input-manual-bilirubin" name="input-manual-bilirubin" placeholder="" required>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label class="form-label" for="default-01">ALK_POSPHATE</label>
									<div class="form-control-wrap">
										<input type="number" class="form-control input-manual" value="1" id="input-manual-alk_posphate" name="input-manual-alk_posphate" placeholder="" required>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label class="form-label" for="default-01">SGOT</label>
									<div class="form-control-wrap">
										<input type="number" class="form-control input-manual" value="1" id="input-manual-sgot" name="input-manual-sgot" placeholder="" required>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label class="form-label" for="default-01">ALBUMIN</label>
									<div class="form-control-wrap">
										<input type="number" class="form-control input-manual" value="1" id="input-manual-albumin" name="input-manual-albumin" placeholder="" required>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label class="form-label" for="default-01">PROTIME</label>
									<div class="form-control-wrap">
										<input type="number" class="form-control input-manual" value="1" id="input-manual-protime" name="input-manual-protime" placeholder="" required>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label class="form-label" for="default-01">HISTOLOGY</label>
									<div class="form-control-wrap">
										<input type="number" class="form-control input-manual" value="1" id="input-manual-histology" name="input-manual-histology" placeholder="" required>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label class="form-label" for="default-01">CLASS</label>
									<div class="form-control-wrap">
										<input type="number" class="form-control input-manual" value="1" id="input-manual-kelas" name="input-manual-kelas" placeholder="" required>
									</div>
								</div>
							</div>
							<div class="col-sm-12">
								<button type="submit" class="btn btn-primary">Simpan data</button>
							</div>
						</div>
					</form>
				</div>
				<div class="tab-pane " id="tabExcel">
					<input type="file" name="input-file-excel" id="input-file-excel" >
					<button type="button" class="btn btn-primary" id="btn-import">Import Data</button>


					<div>
						<table class="nowrap table" id="table-import" >
							<thead>
								<tr>
									<th>AGE</th>
									<th>SEX</th>
									<th>STEROID</th>
									<th>ANTIVIRALS</th>
									<th>FATIGUE</th>
								</tr>
							</thead>

						</table>
					</div>

				</div>



			</div>
		</div>
	</div>
</div>

{% endblock content %}
{% block export-js %}
<script src="{% static 'plugins/sheetjs/dist/xlsx.full.min.js' %}"></script>

{% endblock export-js %}
{% block js %}
<script>

	$("#form-tambah-manual").submit(function(event) {
		event.preventDefault();
		var URL = "{% url 'lvq/proses_tambah_data_master' %}";
		var data = new FormData($(this)[0]);
		console.log(data);
		axios.post(URL, data)
		.then((res) => {
			data = res.data;
			console.log(data);
		})
		.catch(() => {

		})
		.then(() => {

		})

	});

	var json_object = '';
	$("#btn-import").click(function(event) {
		var selectedFile = $("#input-file-excel")[0].files[0];
		var reader = new FileReader();
		reader.onload = function(event) {
			var data = event.target.result;
			var workbook = XLSX.read(data, {
				type: 'binary'
			});

			workbook.SheetNames.forEach(function(sheetName) {

				var XL_row_object = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);
				json_object  = (XL_row_object);
			})
			var URL = '{% url "lvq/proses_import_data_master" %}';
			axios.post(URL, json_object)
			.then((res) => {
				data = res.data;


			});
			$dTableImport.clear();
			$dTableImport.rows.add(json_object);
			$dTableImport.draw();

		};
		reader.onerror = function(event) {
			console.error("File tidak bisa diimport Code " + event.target.error.code);
		};
		reader.readAsBinaryString(selectedFile);

	});

	var $dTableImport = makeDataTable('#table-import', {
		"scrollX": true,
		"responsive": false,
		"columns": [
		{ "data": "First Name" },
		{ "data": "Last Name" },
		{ "data": "sex" },
		{ "data": "age" },
		{ "data": "hyn" },
		],
	});

</script>
{% endblock js %}